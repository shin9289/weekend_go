from django.conf import settings
import requests
from bs4 import BeautifulSoup

from linebot import LineBotApi
from linebot.models import TextSendMessage

line_bot_api = LineBotApi(settings.LINE_CHANNEL_ACCESS_TOKEN)

def sendText(event):
    try:
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text='æˆåŠŸ'))
    except:
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text='éŒ¯èª¤'))

#æ¾å±±æ–‡å‰µåœ’å€
def songshan(event):
    url = "https://www.songshanculturalpark.org/exhibition"
    res = requests.get(url)
    soup = BeautifulSoup(res.text, 'html.parser')
    rows = soup.select('.rows')

    activity_info = []
    activity_info.append("ğŸ‰æ¾å±±æ–‡å‰µåœ’å€ğŸ‰")
    for row in rows:
        date = row.select_one('.date').text.strip()
        title = row.select_one('.lv_h2').text.strip()
        link = row.select_one('.btn')['href']
        activity_info.append(f"\næ´»å‹•åç¨±ï¼š{date}\næ´»å‹•æ—¥æœŸï¼š{title}\næ´»å‹•é€£çµï¼šhttps://www.songshanculturalpark.org{link}")

    if activity_info:
        news_text = "\n".join(activity_info)
        try:
            line_bot_api.reply_message(event.reply_token,TextSendMessage(text=news_text))
                
        except:
            line_bot_api.reply_message(event.reply_token,TextSendMessage(text="æŠ±æ­‰ï¼Œæ²’æœ‰æ‰¾åˆ°æœ€æ–°æ¶ˆæ¯ã€‚"))
    else:
        line_bot_api.reply_message(event.reply_token, TextSendMessage(text="éŒ¯èª¤2"))
